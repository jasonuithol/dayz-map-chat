<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DayZ Map Intel</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Courier New', monospace;
    background: #0a0c08;
    color: #c8d4b0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(
      0deg, transparent, transparent 2px,
      rgba(0,0,0,0.07) 2px, rgba(0,0,0,0.07) 4px
    );
    pointer-events: none;
    z-index: 100;
  }

  header {
    background: #111a0d;
    border-bottom: 1px solid #2a3d1c;
    padding: 12px 20px;
    display: flex;
    align-items: center;
    gap: 14px;
    flex-shrink: 0;
  }

  .logo {
    width: 38px; height: 38px;
    background: #1e2e14;
    border: 1px solid #3a5a20;
    border-radius: 4px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
  }

  header h1 { font-size: 15px; color: #8fbc4a; letter-spacing: 3px; text-transform: uppercase; }
  header p  { font-size: 10px; color: #556644; letter-spacing: 1px; margin-top: 2px; }

  .map-selector { margin-left: auto; display: flex; gap: 6px; }

  .map-btn {
    background: #1a2610; border: 1px solid #2a3d1c; color: #6a8a3a;
    font-family: 'Courier New', monospace; font-size: 10px; letter-spacing: 1px;
    padding: 5px 10px; cursor: pointer; text-transform: uppercase; transition: all 0.15s;
  }
  .map-btn:hover, .map-btn.active { background: #2a3d1c; color: #8fbc4a; border-color: #5a8a2a; }

  #chat-container {
    flex: 1; overflow-y: auto; padding: 20px;
    display: flex; flex-direction: column; gap: 16px;
    scrollbar-width: thin; scrollbar-color: #2a3d1c #0a0c08;
  }
  #chat-container::-webkit-scrollbar { width: 6px; }
  #chat-container::-webkit-scrollbar-track { background: #0a0c08; }
  #chat-container::-webkit-scrollbar-thumb { background: #2a3d1c; }

  .msg { display: flex; gap: 12px; max-width: 860px; animation: fadeIn 0.2s ease; }
  @keyframes fadeIn { from { opacity:0; transform:translateY(4px); } to { opacity:1; transform:translateY(0); } }
  .msg.user { flex-direction: row-reverse; align-self: flex-end; }

  .avatar {
    width: 32px; height: 32px; border-radius: 3px;
    display: flex; align-items: center; justify-content: center;
    font-size: 14px; flex-shrink: 0; margin-top: 2px;
  }
  .msg.user .avatar { background: #1e2e14; border: 1px solid #4a6a2a; }
  .msg.ai   .avatar { background: #152010; border: 1px solid #3a5a20; }

  .msg-body { display: flex; flex-direction: column; gap: 10px; max-width: 820px; }

  .bubble {
    padding: 10px 14px; border-radius: 3px;
    font-size: 13px; line-height: 1.7;
  }
  .msg.user .bubble { background: #1a2810; border: 1px solid #2e4a1a; color: #b0cc88; }
  .msg.ai   .bubble { background: #111a0d; border: 1px solid #253520; color: #c8d4b0; }
  .bubble strong { color: #8fbc4a; }
  .bubble em { color: #6a9a3a; font-style: normal; }

  /* SVG map panel */
  .map-panel {
    background: #0c1509;
    border: 1px solid #2a4a18;
    border-radius: 3px;
    padding: 10px;
    position: relative;
  }
  .map-panel-label {
    font-size: 9px; color: #4a7a2a; letter-spacing: 2px;
    text-transform: uppercase; margin-bottom: 8px;
  }
  .map-panel svg {
    width: 100%; height: auto;
    display: block;
  }

  .typing-indicator { display: flex; gap: 5px; padding: 4px 0; align-items: center; }
  .typing-indicator span {
    width: 6px; height: 6px; background: #4a7a2a; border-radius: 50%;
    animation: blink 1.2s infinite;
  }
  .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
  .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
  @keyframes blink {
    0%,80%,100% { opacity:0.2; transform:scale(0.8); }
    40% { opacity:1; transform:scale(1); }
  }

  .suggestions {
    display: flex; flex-wrap: wrap; gap: 8px;
    padding: 0 20px 12px; flex-shrink: 0;
  }
  .sug-btn {
    background: #111a0d; border: 1px solid #253520; color: #6a8a4a;
    font-family: 'Courier New', monospace; font-size: 11px;
    padding: 6px 12px; cursor: pointer; border-radius: 2px;
    transition: all 0.15s; letter-spacing: 0.5px;
  }
  .sug-btn:hover { background: #1a2810; border-color: #3a5a2a; color: #8fbc4a; }

  footer {
    background: #0e1509; border-top: 1px solid #1e2e14;
    padding: 14px 20px; display: flex; gap: 10px; flex-shrink: 0;
  }
  #input {
    flex: 1; background: #111a0d; border: 1px solid #2a3d1c;
    color: #c8d4b0; font-family: 'Courier New', monospace; font-size: 13px;
    padding: 10px 14px; outline: none; border-radius: 2px; transition: border-color 0.15s;
  }
  #input:focus { border-color: #4a7a2a; }
  #input::placeholder { color: #3a5030; }

  #send-btn {
    background: #1e3010; border: 1px solid #3a5a20; color: #8fbc4a;
    font-family: 'Courier New', monospace; font-size: 12px; letter-spacing: 2px;
    padding: 10px 20px; cursor: pointer; text-transform: uppercase;
    transition: all 0.15s; border-radius: 2px;
  }
  #send-btn:hover:not(:disabled) { background: #2a4a18; border-color: #5a8a30; }
  #send-btn:disabled { opacity: 0.4; cursor: not-allowed; }

  .status-bar {
    font-size: 10px; color: #3a5030; letter-spacing: 1px;
    padding: 0 20px 8px; flex-shrink: 0;
  }
  .status-bar .online { color: #4a8a30; }
</style>
</head>
<body>

<header>
  <div class="logo">üó∫Ô∏è</div>
  <div>
    <h1>DayZ Map Intel</h1>
    <p>SURVIVAL INTELLIGENCE SYSTEM v3.0</p>
  </div>
  <div class="map-selector">
    <button class="map-btn active" data-map="Chernarus">Chernarus</button>
    <button class="map-btn" data-map="Livonia">Livonia</button>
    <button class="map-btn" data-map="Sakhal">Sakhal</button>
  </div>
</header>

<div id="chat-container">
  <div class="msg ai">
    <div class="avatar">üì°</div>
    <div class="msg-body">
      <div class="bubble">
        <strong>// DAYZ MAP INTEL ONLINE</strong><br><br>
        Survivor, you've connected to the map intelligence system. I have detailed knowledge of <strong>Chernarus</strong>, <strong>Livonia</strong>, and <strong>Sakhal</strong> ‚Äî loot spawns, navigation routes, base building spots, food sources, and more.<br><br>
        Ask about navigation or locations and I'll draw you a <strong>schematic map</strong> alongside my answer. Select your map above and transmit.
      </div>
    </div>
  </div>
</div>

<div class="suggestions" id="suggestions">
  <button class="sug-btn">Best military loot spots?</button>
  <button class="sug-btn">High-tier loot route?</button>
  <button class="sug-btn">Safe base building locations?</button>
  <button class="sug-btn">Where can I fish?</button>
  <button class="sug-btn">Best fruit trees & berry bushes?</button>
  <button class="sug-btn">Where to find animals to hunt?</button>
  <button class="sug-btn">Navigate from coast to NWAF?</button>
  <button class="sug-btn">Food loot in towns?</button>
</div>

<div class="status-bar">
  MAP: <span id="status-map" class="online">CHERNARUS</span> &nbsp;|&nbsp; STATUS: <span class="online">CONNECTED</span>
</div>

<footer>
  <input id="input" type="text" placeholder="Ask about locations, loot, navigation, food sources..." maxlength="400" />
  <button id="send-btn">TRANSMIT</button>
</footer>

<script>
  const chatContainer = document.getElementById('chat-container');
  const input        = document.getElementById('input');
  const sendBtn      = document.getElementById('send-btn');
  const statusMap    = document.getElementById('status-map');

  let activeMap = 'Chernarus';
  let conversationHistory = [];

  document.querySelectorAll('.map-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.map-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeMap = btn.dataset.map;
      statusMap.textContent = activeMap.toUpperCase();
      conversationHistory = [];
      addMessage('ai', { text: `Switching to <strong>${activeMap}</strong> map data. Conversation history cleared. What do you need?` });
    });
  });

  document.getElementById('suggestions').addEventListener('click', e => {
    if (e.target.classList.contains('sug-btn')) {
      input.value = e.target.textContent;
      sendMessage();
    }
  });

  function addMessage(role, data, isTyping = false) {
    const msg = document.createElement('div');
    msg.classList.add('msg', role);

    const avatar = document.createElement('div');
    avatar.classList.add('avatar');
    avatar.textContent = role === 'user' ? 'üéñÔ∏è' : 'üì°';

    const body = document.createElement('div');
    body.classList.add('msg-body');

    const bubble = document.createElement('div');
    bubble.classList.add('bubble');

    if (isTyping) {
      bubble.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
      msg.id = 'typing-msg';
      body.appendChild(bubble);
    } else {
      bubble.innerHTML = typeof data === 'string' ? data : data.text || '';
      body.appendChild(bubble);

      // Render SVG map if present
      if (data && data.svg) {
        const panel = document.createElement('div');
        panel.classList.add('map-panel');
        const label = document.createElement('div');
        label.classList.add('map-panel-label');
        label.textContent = '// SCHEMATIC MAP';
        panel.appendChild(label);
        panel.innerHTML += data.svg;
        body.appendChild(panel);
      }
    }

    msg.appendChild(avatar);
    msg.appendChild(body);
    chatContainer.appendChild(msg);
    chatContainer.scrollTop = chatContainer.scrollHeight;
    return msg;
  }

  function removeTyping() {
    const t = document.getElementById('typing-msg');
    if (t) t.remove();
  }

  function buildSystemPrompt() {
    return `You are a DayZ survival map expert. The player is on: ${activeMap}.

RESPONSE FORMAT ‚Äî You MUST always respond with a valid JSON object with exactly these fields:
{
  "text": "your tactical answer here (HTML allowed: <strong>, <br>, <em>)",
  "svg": "..."
}

The "svg" field:
- INCLUDE an SVG schematic map whenever the question involves navigation, routes, locations, or spatial relationships between places.
- OMIT (set to null) for questions purely about mechanics, food foraging tips, loot tables with no location context, etc.
- When drawing SVG maps, use viewBox="0 0 500 400", background rect fill="#0c1209"
- Style: dark military terminal aesthetic
  - Background: #0c1209
  - Water/rivers: #1a3a4a stroke, #0e2030 fill
  - Roads: #3a3a2a dashed stroke
  - Forest areas: #1a2a10 fill, #2a4a18 stroke
  - Town dots: fill="#4a7a2a" r=6 for small, r=9 for large cities
  - Military zones: fill="#7a2a2a" r=8, stroke="#aa4a4a"
  - Player/start location: fill="#8fbc4a" r=8 with a pulsing look (stroke="#aae060" stroke-width="2")
  - Route lines: stroke="#8fbc4a" stroke-width="2.5" stroke-dasharray="8,4"
  - Labels: fill="#c8d4b0" font-family="monospace" font-size="11"
  - Compass rose in corner
  - Legend if needed
- Make maps informative and clear ‚Äî show relative positions accurately based on your knowledge of the map
- For Chernarus: north coast is top, south coast (spawn coast) is bottom, NWAF is top-left, NEAF is top-right
- For Livonia: dense central forest, towns scattered around
- For Sakhal: roughly square, volcanic caldera in centre, coastal villages around edges

MAP KNOWLEDGE:
Chernarus (15x15km, NW corner = military, SE = spawn coast):
- South coast (spawns): Kamyshovo, Elektrozavodsk, Chernogorsk, Komarovo, Balota(airfield)
- Mid-map: Zelenogorsk(W), Stary/Novy Sobor(centre), Gorka(E), Polana(E)
- North: NWAF(far NW), Tisy Military(NW), Vybor, Lopatino, Kabanino, Krasnostav(NE), NEAF(far NE), Berezino(E coast)
- Rivers run roughly N-S through centre; Green Mountain is isolated hill mid-west

Livonia (8x8km):
- Nadbor (large, N-centre), Sitnik (NE), Grabin (SE), Polana factory (E), Lukow (S), Bielawa (SW), Tarnow (NW)
- Dense forest in W and centre; swamps in S; rivers run E-W

Sakhal (~8x8km, volcanic island):
- Caldera/volcano in centre-north
- Coastal settlements clockwise: Krasnogorsk(SW), Tikhaya(S), Beregovoy(SE), Izolirovannyy(NE), Novorossiysk(NW)
- Cold wet climate; fishing crucial; dense forests on lower slopes

Keep text responses tactical, specific, and concise. Bold location names with <strong>. Separate paragraphs with <br><br>.`;
  }

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    input.value = '';
    sendBtn.disabled = true;

    addMessage('user', { text: escapeHtml(text) });
    conversationHistory.push({ role: 'user', content: text });

    addMessage('ai', null, true);

    try {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 2000,
          system: buildSystemPrompt(),
          messages: conversationHistory
        })
      });

      const data = await response.json();
      const rawText = data.content?.[0]?.text || '{"text":"Signal lost. Try again, survivor.","svg":null}';

      let parsed;
      try {
        const cleaned = rawText.replace(/```json|```/g, '').trim();
        parsed = JSON.parse(cleaned);
      } catch {
        parsed = { text: formatReply(rawText), svg: null };
      }

      conversationHistory.push({ role: 'assistant', content: rawText });

      removeTyping();
      addMessage('ai', { text: formatReply(parsed.text || ''), svg: parsed.svg || null });

    } catch (err) {
      removeTyping();
      addMessage('ai', { text: '<strong>// SIGNAL LOST</strong><br>Unable to reach intel network. Check connection and retry.' });
    }

    sendBtn.disabled = false;
    input.focus();
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  function formatReply(text) {
    if (!text) return '';
    return text
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\*(.*?)\*/g, '<em>$1</em>')
      .replace(/\n\n/g, '<br><br>')
      .replace(/\n/g, '<br>');
  }

  function escapeHtml(text) {
    return text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
  });
  input.focus();
</script>
</body>
</html>
